<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理測驗：解鎖你的 Galaxy 原型人格</title>
    
    <!-- START: GA4 Global Site Tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-631RLVDD3T"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-631RLVDD3T');
    </script>
    <!-- END: GA4 Global Site Tag (gtag.js) -->

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8; /* A slightly cooler, more modern light gray */
        }
        .galaxy-background {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at top, #d4e0ff, transparent),
                        radial-gradient(ellipse at bottom, #e1d4ff, transparent);
            opacity: 0.4;
            z-index: -1;
            overflow: hidden;
        }
        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .option-btn {
            transition: all 0.25s ease-in-out;
            border: 2px solid transparent;
            background-color: #ffffff;
            box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.08);
        }
        .option-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.15);
            border-color: #6366f1; /* Indigo */
        }
        .primary-btn {
            background: linear-gradient(45deg, #6366f1, #a855f7); /* Indigo to Purple */
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.2);
        }
        .primary-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }
        /* MODIFIED: Updated result page background colors */
        .result-bg-A { background: linear-gradient(135deg, #4b5563 0%, #1f2937 100%); } /* Black/Grey */
        .result-bg-B { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); }
        .result-bg-C { background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%); } /* Light Blue */
        .result-bg-D { background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); } /* Silver */
    </style>
</head>
<body class="relative">
    <div class="galaxy-background"></div>

    <div class="flex items-center justify-center min-h-screen p-4">
        <div id="quiz-app" class="w-full max-w-xl mx-auto">

            <!-- MODIFIED: Start Screen with the correct raw GitHub image URL -->
            <div id="start-screen" class="w-full max-w-xl mx-auto rounded-3xl shadow-2xl shadow-indigo-100 overflow-hidden flex flex-col justify-end items-center fade-in-up" 
                 style="background-image: url('https://raw.githubusercontent.com/andyhhsu/Galaxy-Archetype-Quiz/main/phone.png'); background-size: cover; background-position: center; height: 80vh; max-height: 700px;">
                
                <div class="p-8 w-full">
                    <button onclick="startQuiz()" class="w-full bg-white text-indigo-600 font-bold py-4 px-8 rounded-full text-lg hover:bg-slate-200 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
                        開始測驗
                    </button>
                </div>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" style="display: none;">
                 <div class="bg-white rounded-3xl shadow-2xl shadow-indigo-100 p-6 md:p-8 min-h-[550px] flex flex-col">
                    <div class="flex-shrink-0">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-indigo-600">Question <span id="question-number">1</span>/5</h2>
                            <div class="w-full bg-gray-200 rounded-full h-3 ml-4">
                                <div id="progress-bar" class="bg-indigo-500 h-3 rounded-full transition-all duration-500" style="width: 20%"></div>
                            </div>
                        </div>
                        <p id="question-text" class="text-lg md:text-xl font-bold text-slate-800 mb-8 min-h-[60px]"></p>
                    </div>
                    <div id="options-container" class="space-y-4 flex-grow flex flex-col justify-center"></div>
                </div>
            </div>
            
            <!-- Tie-breaker Screen -->
            <div id="tiebreaker-screen" style="display: none;">
                 <div class="bg-white rounded-3xl shadow-2xl shadow-indigo-100 p-6 md:p-8 text-center min-h-[550px] flex flex-col justify-center items-center">
                    <h2 class="text-2xl font-bold text-slate-800">最後一步！</h2>
                    <p class="mt-3 text-slate-600 max-w-sm">你的內心住著多種靈魂！在以下特質中，你覺得此刻的自己更偏向哪一個？</p>
                    <div id="tiebreaker-options" class="mt-8 space-y-4 w-full"></div>
                </div>
            </div>

            <!-- Result Screen -->
            <div id="result-screen" style="display: none;">
                <div id="result-card-content" class="rounded-3xl shadow-2xl shadow-indigo-200 overflow-hidden">
                    <div class="p-8 text-center">
                        <p id="result-intro" class="font-semibold text-gray-700">你的 Galaxy 原型人格是...</p>
                        <h2 id="result-prototype" class="text-4xl font-black mt-1 text-slate-800"></h2>
                        <p id="result-title" class="text-xl font-bold mt-2 text-indigo-700"></p>
                    </div>
                    <div class="px-8 flex justify-center">
                        <!-- This image's src will be dynamically changed by JavaScript -->
                        <img id="result-image" src="" alt="手機圖片" class="w-auto h-60 md:h-64 object-contain drop-shadow-2xl -mb-8">
                    </div>
                    <div class="bg-white/50 backdrop-blur-lg p-8 pt-12">
                        <p id="result-description" class="text-base text-gray-800 leading-relaxed text-center"></p>
                         <div class="mt-8 bg-white/80 border border-gray-200 rounded-2xl p-5 text-center">
                            <h3 class="text-lg font-bold text-center text-indigo-800">🎁 已解鎖：專屬線下好禮 🎁</h3>
                            <p class="mt-2 font-semibold">憑此結果畫面，親臨【微風南山三星旗艦體驗館】，即可兌換：</p>
                            <p class="mt-2 text-2xl font-bold text-indigo-600">7-ELEVEN 現萃茶一杯</p>
                            <p class="text-xs text-slate-500 mt-1">(每日限量，送完為止，活動詳情以現場公告為準)</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="restartQuiz()" class="w-full max-w-xs mx-auto bg-white text-indigo-600 font-bold py-3 px-8 rounded-full hover:bg-slate-200 transition-colors duration-300 shadow-lg">
                        再測一次
                    </button>
                </div>

                <!-- Promotion block -->
                <div id="new-promotion-block" class="mt-6 bg-white/80 backdrop-blur-xl border-2 border-dashed border-teal-400 rounded-2xl p-6 text-center shadow-lg">
                    <h3 class="text-2xl font-bold text-teal-600">🎉 同場加映：填問卷抽好禮！🎉</h3>
                    <p class="mt-2 text-slate-700 font-semibold">即日起至 2025/7/24，完成新機預熱問卷，就有機會抽中 Galaxy Fit3、無線閃充充電板等精美好禮！</p>
                    <a href="https://www.de-hm.com/20/262?test_code=cd488486048b79ebb40b59da53f18a06f8f2063868b6d7998e8ad29c33b0e7b0&test_expired=1751096985" 
                       target="_blank" 
                       onclick="trackSurveyClick()"
                       class="mt-4 inline-block bg-teal-500 text-white font-bold py-3 px-8 rounded-full text-base hover:bg-teal-600 transition-all duration-300 transform hover:scale-105 shadow-md">
                        前往問卷抽大獎
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const quizData = [
            {
                question: "一個完美的週末午後，你會選擇如何度過？",
                options: [
                    { text: "找間有質感的咖啡廳，從容地處理完下週的待辦事項，享受一切盡在掌握的成就感。", type: 'A' },
                    { text: "跟閨密約好 dress code，在最熱門的打卡點，捕捉彼此最上鏡的瞬間。", type: 'B' },
                    { text: "為了不錯過偶像的每個表情，就算位置再遠，也要記錄下最珍貴的舞台瞬間。", type: 'C' },
                    { text: "一趟說走就走的城市漫遊，隨性鑽進陌生巷弄，享受無障礙探索的樂趣。", type: 'D' }
                ]
            },
            {
                question: "當你規劃一場旅行時，你更偏好像…",
                options: [
                    { text: "行程表塞滿，公事和玩樂無縫切換，每一分鐘都要淋漓盡致。", type: 'A' },
                    { text: "精心規劃每一天的穿搭，因為旅途中的每個角落，都是我的伸展台。", type: 'B' },
                    { text: "把大部分預算都花在「體驗」上，例如演唱會 VIP 區或國家公園的特殊導覽。", type: 'C' },
                    { text: "只訂好機票住宿，剩下的交給心情決定，相信總會有意想不到的驚喜。", type: 'D' }
                ]
            },
            {
                question: "在社群媒體上，你最傾向分享哪種內容？",
                options: [
                    { text: "富有洞見的產業趨勢分析，或是能展現專業形象的內容。", type: 'A' },
                    { text: "精心調色過的生活美學照片，每一張都代表著我的個人品味。", type: 'B' },
                    { text: "一張千載難逢的奇景照，例如稍縱即逝的流星雨或野生動物。", type: 'C' },
                    { text: "各種實用資訊或讓生活更便利的聰明小技巧。", type: 'D' }
                ]
            },
            {
                question: "選購一件新的科技產品時，哪個特點最讓你心動？",
                options: [
                    { text: "能徹底顛覆我的工作流程，提供前所未有的生產力。", type: 'A' },
                    { text: "設計是否獨特、時尚，能否成為我個人風格的延伸。", type: 'B' },
                    { text: "是否擁有最頂級的專業性能，能滿足我對完美的偏執。", type: 'C' },
                    { text: "能否無縫融入我的生活，讓一切都變得更聰明、更簡單。", type: 'D' }
                ]
            },
            {
                question: "如果可以用一種方式形容你的生活哲學，那會是？",
                options: [
                    { text: "「時間就是金錢」—— 我總是在思考如何最大化每一分鐘的價值。", type: 'A' },
                    { text: "「生活要有儀式感」—— 我享受在平凡日常中創造屬於自己的閃亮時刻。", type: 'B' },
                    { text: "「追求極致，近乎偏執」—— 對於我熱愛的事物，99分都不能算是及格。", type: 'C' },
                    { text: "「聰明工作，而不是辛苦工作」—— 我總能找到最高效省力的方法解決問題。", type: 'D' }
                ]
            }
        ];

        // MODIFIED: Reverted result images to the state before the last change.
        const results = {
            'A': { title: "Galaxy Fold7", prototype: "運籌帷幄的「開創者」", description: "你追求極致效率，是天生的多工處理大師。Galaxy Fold7 的沉浸式大螢幕與超薄機身，讓你隨時隨地都能展開強大生產力，完美契合你的商務精英本色。", image: "https://placehold.co/600x600/a8b2ff/1f2937?text=Z+Fold7+圖片", bgClass: "result-bg-A" },
            'B': { title: "Galaxy Flip7", prototype: "引領潮流的「風格家」", description: "你是自帶光芒的時尚焦點，對美感有著敏銳直覺。Galaxy Flip7 的精巧設計與強大封面螢幕，讓你無需展開手機即可快速自拍，輕鬆定義屬於你的獨特風格。", image: "https://placehold.co/600x600/fbc2eb/1f2937?text=Z+Flip7+圖片", bgClass: "result-bg-B" },
            'C': { title: "Galaxy S25 Ultra", prototype: "追求極致的「創造家」", description: "你對細節有著近乎偏執的追求，渴望捕捉每個不容錯過的瞬間。Galaxy S25 Ultra 是你的演唱會神器，憑藉其無可匹敵的超強遠拍功能，再遠的舞台都是你的搖滾區。", image: "https://images.samsung.com/is/image/samsung/p6pim/tw/2501/gallery/tw-galaxy-s25-s938-sm-s9380zbwbri-544716806?imbypass=true", bgClass: "result-bg-C" },
            'D': { title: "Galaxy S25 Edge", prototype: "聰明生活的「全能者」", description: "你務實、聰明且懂得平衡，總能找到最高效的生活方式。Galaxy S25 Edge 的輕巧機身與全方位 AI 功能，是你探索生活的最佳夥伴，讓一切都變得輕鬆又簡單。", image: "https://images.samsung.com/is/image/samsung/p6pim/tw/ps_2504/gallery/tw-galaxy-s25-s937-sm-s9370zsgbri-546491970?imbypass=true", bgClass: "result-bg-D" }
        };

        let currentQuestionIndex = 0;
        let userAnswers = [];

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const tiebreakerScreen = document.getElementById('tiebreaker-screen');
        
        const questionNumberEl = document.getElementById('question-number');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainerEl = document.getElementById('options-container');
        const progressBarEl = document.getElementById('progress-bar');
        
        const GOOGLE_SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbxr6_8Vox2BHm_kNJCeILgBHeO6vTvJqCVYNgSg84ty2FM6pOFyTq9aC4tVVMwvJdpQ/exec';

        async function trackEventToSheet(eventName, eventValue) {
            if (!GOOGLE_SHEET_API_URL) {
                console.warn('Google Sheet API URL尚未設定，無法紀錄數據。');
                return;
            }
            
            try {
                await fetch(GOOGLE_SHEET_API_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        event: eventName,
                        value: eventValue,
                        timestamp: new Date().toISOString()
                    }),
                });
                console.log(`Event sent to Google Sheet: ${eventName}, Value: ${eventValue}`);
            } catch (error) {
                console.error('Failed to send event to Google Sheet:', error);
            }
        }

        function trackSurveyClick() {
            gtag('event', 'survey_click', {
              'event_category': 'engagement',
              'event_label': 'new_model_survey'
            });
            trackEventToSheet('survey_click');
        }

        function triggerAnimation(element) {
            if (!element) return;
            element.classList.remove('fade-in-up');
            void element.offsetWidth; 
            element.classList.add('fade-in-up');
        }

        function startQuiz() {
            gtag('event', 'quiz_start', {
              'event_category': 'engagement',
              'event_label': 'galaxy_archetype_quiz'
            });

            currentQuestionIndex = 0;
            userAnswers = [];
            startScreen.style.display = 'none';
            resultScreen.style.display = 'none';
            tiebreakerScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            triggerAnimation(quizScreen.firstElementChild);
            showQuestion();
        }

        function showQuestion() {
            const questionData = quizData[currentQuestionIndex];
            questionNumberEl.textContent = currentQuestionIndex + 1;
            questionTextEl.textContent = questionData.question;
            optionsContainerEl.innerHTML = '';

            questionData.options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'w-full text-left p-4 rounded-xl option-btn hover:bg-indigo-50';
                button.innerHTML = `<span class="font-bold text-indigo-600 mr-3">${option.type}</span> ${option.text}`;
                button.onclick = () => selectOption(option.type);
                optionsContainerEl.appendChild(button);
            });
            
            progressBarEl.style.width = `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;
        }

        function selectOption(type) {
            const buttons = optionsContainerEl.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);

            userAnswers.push(type);
            currentQuestionIndex++;
            
            setTimeout(() => {
                if (currentQuestionIndex < quizData.length) {
                    const quizCard = quizScreen.firstElementChild;
                    quizCard.classList.remove('fade-in-up');
                    void quizCard.offsetWidth;
                    quizCard.classList.add('fade-in-up');
                    showQuestion();
                } else {
                    calculateResult();
                }
            }, 300);
        }

        function calculateResult() {
            const counts = userAnswers.reduce((acc, answer) => {
                acc[answer] = (acc[answer] || 0) + 1;
                return acc;
            }, {});

            const sortedCounts = Object.entries(counts).sort((a, b) => b[1] - a[1]);
            
            if (sortedCounts.length > 1 && sortedCounts[0][1] === sortedCounts[1][1]) {
                const tiedTypes = sortedCounts.filter(entry => entry[1] === sortedCounts[0][1]);
                showTiebreaker(tiedTypes);
            } else {
                const finalResultType = sortedCounts[0][0];
                showResult(finalResultType);
            }
        }
        
        function showTiebreaker(tiedResults) {
            quizScreen.style.display = 'none';
            tiebreakerScreen.style.display = 'block';
            triggerAnimation(tiebreakerScreen.firstElementChild);
            const tiebreakerOptionsEl = document.getElementById('tiebreaker-options');
            tiebreakerOptionsEl.innerHTML = '';
            
            tiedResults.forEach(result => {
                const type = result[0];
                if(results[type]) {
                    const button = document.createElement('button');
                    // MODIFIED: This button now uses the new primary-btn style
                    button.className = 'w-full text-center p-4 text-white rounded-full option-btn text-lg font-bold primary-btn';
                    button.textContent = `我更像是：${results[type].prototype}`;
                    button.onclick = () => showResult(type);
                    tiebreakerOptionsEl.appendChild(button);
                }
            });
        }

        function showResult(type) {
            gtag('event', 'quiz_complete', {
                'event_category': 'milestone',
                'event_label': 'galaxy_archetype_quiz',
                'value': type 
            });

            trackEventToSheet('quiz_result', type);

            const resultData = results[type];
            document.getElementById('result-title').textContent = resultData.title;
            document.getElementById('result-prototype').textContent = resultData.prototype;
            document.getElementById('result-description').textContent = resultData.description;
            document.getElementById('result-image').src = resultData.image;
            document.getElementById('result-image').alt = resultData.title;
            
            const resultCardContent = document.getElementById('result-card-content');
            resultCardContent.className = 'rounded-3xl shadow-2xl shadow-indigo-200 overflow-hidden'; 
            resultCardContent.classList.add(resultData.bgClass);

            // MODIFIED: Adjust text colors for dark background (Type A)
            const resultIntroEl = document.getElementById('result-intro');
            const resultPrototypeEl = document.getElementById('result-prototype');
            const resultTitleEl = document.getElementById('result-title');
            
            // Reset text colors to default
            resultIntroEl.className = 'font-semibold text-gray-700';
            resultPrototypeEl.className = 'text-4xl font-black mt-1 text-slate-800';
            resultTitleEl.className = 'text-xl font-bold mt-2 text-indigo-700';
            
            if (type === 'A') {
                resultIntroEl.classList.remove('text-gray-700');
                resultIntroEl.classList.add('text-gray-300');
                resultPrototypeEl.classList.remove('text-slate-800');
                resultPrototypeEl.classList.add('text-white');
                resultTitleEl.classList.remove('text-indigo-700');
                resultTitleEl.classList.add('text-indigo-300');
            }

            quizScreen.style.display = 'none';
            tiebreakerScreen.style.display = 'none';
            resultScreen.style.display = 'block';
            triggerAnimation(resultScreen);
        }

        function restartQuiz() {
            resultScreen.style.display = 'none';
            startScreen.style.display = 'block';
            triggerAnimation(startScreen);
        }

    </script>
</body>
</html>
